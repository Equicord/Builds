// Equicord d08ca66
// Standalone: true
// Platform: Universal
// Updater Disabled: false
"use strict";var wn=Object.create;var Me=Object.defineProperty;var Sn=Object.getOwnPropertyDescriptor;var xn=Object.getOwnPropertyNames;var Tn=Object.getPrototypeOf,En=Object.prototype.hasOwnProperty;var q=(e,t)=>()=>(e&&(t=e(e=0)),t);var k=(e,t)=>{for(var r in t)Me(e,r,{get:t[r],enumerable:!0})},qt=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of xn(t))!En.call(e,n)&&n!==r&&Me(e,n,{get:()=>t[n],enumerable:!(i=Sn(t,n))||i.enumerable});return e};var J=(e,t,r)=>(r=e!=null?wn(Tn(e)):{},qt(t||!e||!e.__esModule?Me(r,"default",{value:e,enumerable:!0}):r,e)),bn=e=>qt(Me({},"__esModule",{value:!0}),e);var c=q(()=>{"use strict"});function ne(e,t={}){return new Promise((r,i)=>{Jt.default.get(e,t,n=>{let{statusCode:a,statusMessage:o,headers:s}=n;if(a>=400)return void i(`${a}: ${o} - ${e}`);if(a>=300)return void r(ne(s.location,t));let l=[];n.on("error",i),n.on("data",f=>l.push(f)),n.once("end",()=>r(Buffer.concat(l)))})})}var Jt,nt=q(()=>{"use strict";c();Jt=J(require("https"))});var be=q(()=>{"use strict";c()});var Ie,it=q(()=>{c();Ie="d08ca66"});var V,ot=q(()=>{c();V="Equicord/Equicord"});var Xt,eo,Yt=q(()=>{"use strict";c();it();ot();Xt=`Equicord/${Ie}${V?` (https://github.com/${V})`:""}`,eo=`Equicord${V?` (https://github.com/${V})`:""}`});function De(e){return async function(){try{return{ok:!0,value:await e(...arguments)}}catch(t){return{ok:!1,error:t instanceof Error?{...t}:t}}}}var Qt,Kt=q(()=>{"use strict";c();Qt="equibop.asar"});var nr={};k(nr,{migrateLegacyToAsar:()=>An});async function tr(e){return ne(In+e,{headers:{Accept:"application/vnd.github+json","User-Agent":Xt}})}async function Dn(){if(!await rr())return[];let t=await tr(`/compare/${Ie}...HEAD`);return JSON.parse(t.toString("utf-8")).commits.map(i=>({hash:i.sha.slice(0,7),author:i.author.login,message:i.commit.message.split(`
`)[0]}))}async function rr(){let e=await tr("/releases/latest"),t=JSON.parse(e.toString());return t.name.slice(t.name.lastIndexOf(" ")+1)===Ie?!1:(Ce=t.assets.find(n=>n.name===Qt).browser_download_url,!0)}async function kn(){if(!Ce)return!0;let e=await ne(Ce);return(0,Ne.writeFileSync)(__dirname,e),Ce=null,!0}async function An(){try{if(process.platform==="linux"&&!!process.env.FLATPAK_ID)throw"Flatpak Discord can't automatically be migrated.";let t=await ne(`https://github.com/${V}/releases/latest/download/desktop.asar`);(0,Ne.writeFileSync)((0,er.join)(__dirname,"../equicord.asar"),t),(0,Ne.writeFileSync)(__filename,`// Legacy shim for new asar

require("../equicord.asar");`),R.app.relaunch(),R.app.exit()}catch(e){console.error("Failed to migrate to asar",e),R.app.whenReady().then(()=>{R.dialog.showErrorBox("Legacy Install","The way Equicord loaded was changed and the updater failed to migrate. Please reinstall using the Equicord Installer!"),R.app.exit(1)})}}var R,Ne,er,In,Ce,ir=q(()=>{"use strict";c();nt();be();Yt();R=require("electron"),Ne=require("original-fs"),er=require("path");it();ot();Kt();In=`https://api.github.com/repos/${V}`,Ce=null;R.ipcMain.handle("VencordGetRepo",De(()=>`https://github.com/${V}`));R.ipcMain.handle("VencordGetUpdates",De(Dn));R.ipcMain.handle("VencordUpdate",De(rr));R.ipcMain.handle("VencordBuild",De(kn))});c();var te=require("electron"),Ut=require("path");c();c();ir();c();be();var Ot=require("electron");c();var lt={};k(lt,{fetchTrackData:()=>Mn});c();var or=require("child_process"),ar=require("util"),sr=(0,ar.promisify)(or.execFile);async function st(e){let{stdout:t}=await sr("osascript",e.map(r=>["-e",r]).flat());return t}var L=null,_n=/<script type="module" crossorigin src="([a-zA-Z0-9.\-/]+)"><\/script>/,Pn=/\w+="([A-Za-z0-9-_]*\.[A-Za-z0-9-_]*\.[A-Za-z0-9-_]*)",\w+="x-apple-jingle-correlation-key"/,ct,Rn=async()=>{if(ct)return ct;let e=await fetch("https://music.apple.com/").then(n=>n.text()),t=new URL(e.match(_n)[1],"https://music.apple.com/"),i=(await fetch(t).then(n=>n.text())).match(Pn)[1];return ct=i,i};async function On({id:e,name:t,artist:r,album:i}){if(e===L?.id){if("data"in L)return L.data;if("failures"in L&&L.failures>=5)return null}try{let n=new URL("https://amp-api-edge.music.apple.com/v1/catalog/us/search");n.searchParams.set("platform","web"),n.searchParams.set("l","en-US"),n.searchParams.set("limit","1"),n.searchParams.set("with","serverBubbles"),n.searchParams.set("types","songs"),n.searchParams.set("term",`${t} ${r} ${i}`),n.searchParams.set("include[songs]","artists");let a=await Rn(),o=await fetch(n,{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9",authorization:`Bearer ${a}`,"user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36",origin:"https://music.apple.com"}}).then(s=>s.json()).then(s=>s.results.song.data[0]);return L={id:e,data:{appleMusicLink:o.attributes.url,songLink:`https://song.link/i/${o.id}`,albumArtwork:o.attributes.artwork.url.replace("{w}x{h}","512x512"),artistArtwork:o.relationships.artists.data[0].attributes.artwork.url.replace("{w}x{h}","512x512")}},L.data}catch(n){return console.error("[AppleMusicRichPresence] Failed to fetch remote data:",n),L={id:e,failures:(e===L?.id&&"failures"in L?L.failures:0)+1},null}}async function Mn(){try{await sr("pgrep",["^Music$"])}catch{return null}if(await st(['tell application "Music"',"get player state","end tell"]).then(p=>p.trim())!=="playing")return null;let t=await st(['tell application "Music"',"get player position","end tell"]).then(p=>Number.parseFloat(p.trim())),r=await st(['set output to ""','tell application "Music"',"set t_id to database id of current track","set t_name to name of current track","set t_album to album of current track","set t_artist to artist of current track","set t_duration to duration of current track",'set output to "" & t_id & "\\n" & t_name & "\\n" & t_album & "\\n" & t_artist & "\\n" & t_duration',"end tell","return output"]),[i,n,a,o,s]=r.split(`
`).filter(p=>!!p),l=Number.parseFloat(s),f=await On({id:i,name:n,artist:o,album:a});return{name:n,album:a,artist:o,playerPosition:t,duration:l,...f}}var ut={};k(ut,{initDevtoolsOpenEagerLoad:()=>Cn});c();function Cn(e){let t=()=>e.sender.executeJavaScript("Vencord.Plugins.plugins.ConsoleShortcuts.eagerLoad(true)");e.sender.isDevToolsOpened()?t():e.sender.once("devtools-opened",()=>t())}var dr={};c();var mr=require("electron");c();be();c();var ke=class{pathListeners=new Map;globalListeners=new Set;constructor(t,r={}){this.plain=t,this.store=this.makeProxy(t),Object.assign(this,r)}makeProxy(t,r=t,i=""){let n=this;return new Proxy(t,{get(a,o){let s=a[o];return!(o in a)&&n.getDefaultValue&&(s=n.getDefaultValue({target:a,key:o,root:r,path:i})),typeof s=="object"&&s!==null&&!Array.isArray(s)?n.makeProxy(s,r,`${i}${i&&"."}${o}`):s},set(a,o,s){if(a[o]===s)return!0;Reflect.set(a,o,s);let l=`${i}${i&&"."}${o}`;return n.globalListeners.forEach(f=>f(s,l)),n.pathListeners.get(l)?.forEach(f=>f(s)),!0}})}setData(t,r){if(this.readOnly)throw new Error("SettingsStore is read-only");if(this.plain=t,this.store=this.makeProxy(t),r){let i=t,n=r.split(".");for(let a of n){if(!i){console.warn(`Settings#setData: Path ${r} does not exist in new data. Not dispatching update`);return}i=i[a]}this.pathListeners.get(r)?.forEach(a=>a(i))}this.markAsChanged()}addGlobalChangeListener(t){this.globalListeners.add(t)}addChangeListener(t,r){let i=this.pathListeners.get(t)??new Set;i.add(r),this.pathListeners.set(t,i)}removeGlobalChangeListener(t){this.globalListeners.delete(t)}removeChangeListener(t,r){let i=this.pathListeners.get(t);!i||(i.delete(r),i.size||this.pathListeners.delete(t))}markAsChanged(){this.globalListeners.forEach(t=>t(this.plain,""))}};c();function ft(e,t){for(let r in t){let i=t[r];typeof i=="object"&&!Array.isArray(i)?(e[r]??={},ft(e[r],i)):e[r]??=i}return e}var ze=require("electron"),ie=require("fs");c();var cr=require("electron"),X=require("path"),pe=process.env.EQUICORD_USER_DATA_DIR??process.env.VENCORD_USER_DATA_DIR??(process.env.DISCORD_USER_DATA_DIR?(0,X.join)(process.env.DISCORD_USER_DATA_DIR,"..","EquicordData"):(0,X.join)(cr.app.getPath("userData"),"..","Equicord")),he=(0,X.join)(pe,"settings"),Y=(0,X.join)(pe,"themes"),Le=(0,X.join)(he,"quickCss.css"),pt=(0,X.join)(he,"settings.json"),ht=(0,X.join)(he,"native-settings.json"),lr=["https:","http:","steam:","spotify:","com.epicgames.launcher:","tidal:","itunes:"],ur=process.argv.includes("--vanilla");(0,ie.mkdirSync)(he,{recursive:!0});function pr(e,t){try{return JSON.parse((0,ie.readFileSync)(t,"utf-8"))}catch(r){return r?.code!=="ENOENT"&&console.error(`Failed to read ${e} settings`,r),{}}}var O=new ke(pr("renderer",pt));O.addGlobalChangeListener(()=>{try{(0,ie.writeFileSync)(pt,JSON.stringify(O.plain,null,4))}catch(e){console.error("Failed to write renderer settings",e)}});ze.ipcMain.handle("VencordGetSettingsDir",()=>he);ze.ipcMain.on("VencordGetSettings",e=>e.returnValue=O.plain);ze.ipcMain.handle("VencordSetSettings",(e,t,r)=>{O.setData(t,r)});var Nn={plugins:{}},hr=pr("native",ht);ft(hr,Nn);var fr=new ke(hr);fr.addGlobalChangeListener(()=>{try{(0,ie.writeFileSync)(ht,JSON.stringify(fr.plain,null,4))}catch(e){console.error("Failed to write native settings",e)}});mr.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(r,{frame:i})=>{i.once("dom-ready",()=>{if(i.url.startsWith("https://open.spotify.com/embed/")){let n=O.store.plugins?.FixSpotifyEmbeds;if(!n?.enabled)return;i.executeJavaScript(`
                    const original = Audio.prototype.play;
                    Audio.prototype.play = function() {
                        this.volume = ${n.volume/100||.1};
                        return original.apply(this, arguments);
                    }
                `)}})})});var vr={};c();var gr=require("electron");gr.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(r,{frame:i})=>{i.once("dom-ready",()=>{if(i.url.startsWith("https://www.youtube.com/")){if(!O.store.plugins?.FixYoutubeEmbeds?.enabled)return;i.executeJavaScript(`
                new MutationObserver(() => {
                    if(
                        document.querySelector('div.ytp-error-content-wrap-subreason a[href*="www.youtube.com/watch?v="]')
                    ) location.reload()
                }).observe(document.body, { childList: true, subtree:true });
                `)}})})});var mt={};k(mt,{resolveRedirect:()=>zn});c();var yr=require("https"),Ln=/^https:\/\/(spotify\.link|s\.team)\/.+$/;function wr(e){return new Promise((t,r)=>{let i=(0,yr.request)(new URL(e),{method:"HEAD"},n=>{t(n.headers.location?wr(n.headers.location):e)});i.on("error",r),i.end()})}async function zn(e,t){return Ln.test(t)?wr(t):t}var dt={};k(dt,{makeDeeplTranslateRequest:()=>Gn});c();async function Gn(e,t,r,i){let n=t?"https://api.deepl.com/v2/translate":"https://api-free.deepl.com/v2/translate";try{let a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`DeepL-Auth-Key ${r}`},body:i}),o=await a.text();return{status:a.status,data:o}}catch(a){return{status:-1,data:String(a)}}}var gt={};k(gt,{readRecording:()=>Un});c();var Sr=require("electron"),xr=require("fs/promises"),Ae=require("path");async function Un(e,t){t=(0,Ae.normalize)(t);let r=(0,Ae.basename)(t),i=(0,Ae.normalize)(Sr.app.getPath("userData")+"/");if(console.log(r,i,t),r!=="recording.ogg"||!t.startsWith(i))return null;try{let n=await(0,xr.readFile)(t);return new Uint8Array(n.buffer)}catch{return null}}var vt={};k(vt,{sendToOverlay:()=>Fn});c();var Er=require("dgram"),Tr;function Fn(e,t){t.messageType=t.type;let r=JSON.stringify(t);Tr??=(0,Er.createSocket)("udp4"),Tr.send(r,42069,"127.0.0.1")}var Dr={};c();var Ir=require("electron");c();var br=`"use strict";const hiddenCSS=["#__ffYoutube1","#__ffYoutube2","#__ffYoutube3","#__ffYoutube4","#feed-pyv-container","#feedmodule-PRO","#homepage-chrome-side-promo","#merch-shelf","#offer-module",'#pla-shelf > ytd-pla-shelf-renderer[class="style-scope ytd-watch"]',"#pla-shelf","#premium-yva","#promo-info","#promo-list","#promotion-shelf","#related > ytd-watch-next-secondary-results-renderer > #items > ytd-compact-promoted-video-renderer.ytd-watch-next-secondary-results-renderer","#search-pva","#shelf-pyv-container","#video-masthead","#watch-branded-actions","#watch-buy-urls","#watch-channel-brand-div","#watch7-branded-banner","#YtKevlarVisibilityIdentifier","#YtSparklesVisibilityIdentifier",".carousel-offer-url-container",".companion-ad-container",".GoogleActiveViewElement",'.list-view[style="margin: 7px 0pt;"]',".promoted-sparkles-text-search-root-container",".promoted-videos",".searchView.list-view",".sparkles-light-cta",".watch-extra-info-column",".watch-extra-info-right",".ytd-carousel-ad-renderer",".ytd-compact-promoted-video-renderer",".ytd-companion-slot-renderer",".ytd-merch-shelf-renderer",".ytd-player-legacy-desktop-watch-ads-renderer",".ytd-promoted-sparkles-text-search-renderer",".ytd-promoted-video-renderer",".ytd-search-pyv-renderer",".ytd-video-masthead-ad-v3-renderer",".ytp-ad-action-interstitial-background-container",".ytp-ad-action-interstitial-slot",".ytp-ad-image-overlay",".ytp-ad-overlay-container",".ytp-ad-progress",".ytp-ad-progress-list",'[class*="ytd-display-ad-"]','[layout*="display-ad-"]','a[href^="http://www.youtube.com/cthru?"]','a[href^="https://www.youtube.com/cthru?"]',"ytd-action-companion-ad-renderer","ytd-banner-promo-renderer","ytd-compact-promoted-video-renderer","ytd-companion-slot-renderer","ytd-display-ad-renderer","ytd-promoted-sparkles-text-search-renderer","ytd-promoted-sparkles-web-renderer","ytd-search-pyv-renderer","ytd-single-option-survey-renderer","ytd-video-masthead-ad-advertiser-info-renderer","ytd-video-masthead-ad-v3-renderer","YTM-PROMOTED-VIDEO-RENDERER"],hideElements=()=>{const e=hiddenCSS;if(!e)return;const t=e.join(", ")+" { display: none!important; }",r=document.createElement("style");r.textContent=t,document.head.appendChild(r)},observeDomChanges=e=>{new MutationObserver(r=>{e(r)}).observe(document.documentElement,{childList:!0,subtree:!0})},hideDynamicAds=()=>{const e=document.querySelectorAll("#contents > ytd-rich-item-renderer ytd-display-ad-renderer");e.length!==0&&e.forEach(t=>{if(t.parentNode&&t.parentNode.parentNode){const r=t.parentNode.parentNode;r.localName==="ytd-rich-item-renderer"&&(r.style.display="none")}})},autoSkipAds=()=>{if(document.querySelector(".ad-showing")){const e=document.querySelector("video");e&&e.duration&&(e.currentTime=e.duration,setTimeout(()=>{const t=document.querySelector("button.ytp-ad-skip-button");t&&t.click()},100))}},overrideObject=(e,t,r)=>{if(!e)return!1;let n=!1;for(const o in e)e.hasOwnProperty(o)&&o===t?(e[o]=r,n=!0):e.hasOwnProperty(o)&&typeof e[o]=="object"&&overrideObject(e[o],t,r)&&(n=!0);return n},jsonOverride=(e,t)=>{const r=JSON.parse;JSON.parse=(...n)=>{const o=r.apply(this,n);return overrideObject(o,e,t),o},Response.prototype.json=new Proxy(Response.prototype.json,{async apply(...n){const o=await Reflect.apply(...n);return overrideObject(o,e,t),o}})};jsonOverride("adPlacements",[]),jsonOverride("playerAds",[]),hideElements(),hideDynamicAds(),autoSkipAds(),observeDomChanges(()=>{hideDynamicAds(),autoSkipAds()});
`;Ir.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(r,{frame:i})=>{i.once("dom-ready",()=>{!O.store.plugins?.YoutubeAdblock?.enabled||(i.url.includes("youtube.com/embed/")||i.url.includes("discordsays")&&i.url.includes("youtube.com"))&&i.executeJavaScript(br)})})});var yt={};k(yt,{fetchTrackData:()=>jn});c();async function jn(){let e=await(await fetch("https://gensokyoradio.net/api/station/playing/")).json();return{title:e.SONGINFO.TITLE,album:e.SONGINFO.ALBUM,artist:e.SONGINFO.ARTIST,position:e.SONGTIMES.SONGSTART,duration:e.SONGTIMES.SONGEND,artwork:e.MISC.ALBUMART?`https://gensokyoradio.net/images/albums/500/${e.MISC.ALBUMART}`:"undefined"}}var wt={};k(wt,{RequestRandomUser:()=>Wn,ToBase64ImageUrl:()=>Vn});c();async function Wn(){let e=await fetch("https://randomuser.me/api").then(t=>t.json());return JSON.stringify(e.results[0])}async function Vn(e,t){let{imgUrl:r}=t;try{let i=await fetch(r),n=await i.arrayBuffer(),a=`data:${i.headers.get("Content-Type")||"image/png"};base64,${Buffer.from(n).toString("base64")}`;return JSON.stringify({data:a})}catch(i){return console.error("Error converting image to Base64:",i),JSON.stringify({error:"Failed to convert image to Base64"})}}var Tt={};k(Tt,{checkffmpeg:()=>Kn,checkytdlp:()=>ei,execute:()=>Qn,getStdout:()=>ri,interrupt:()=>ti,isFfmpegAvailable:()=>ii,isYtdlpAvailable:()=>ni,start:()=>$n,stop:()=>Hn});c();var K=require("child_process"),T=J(require("fs")),kr=J(require("os")),xt=J(require("path")),Z=null,Q="",Ge="",St=!1,ae=!1,me=null,de=null,Fe=()=>Z??process.cwd(),oe=e=>xt.default.join(Fe(),e),Ar=()=>{!Z||T.readdirSync(Z).filter(e=>e.startsWith("download.")||e.startsWith("remux.")).forEach(e=>T.unlinkSync(oe(e)))},Ue=e=>(Q+=e,Q=Q.replace(/^.*\r([^\n])/gm,"$1")),$=(...e)=>(console.log(`[Plugin:MediaDownloader] ${e.join(" ")}`),Ge+=`[Plugin:MediaDownloader] ${e.join(" ")}
`),_r=(...e)=>console.error(`[Plugin:MediaDownloader] [ERROR] ${e.join(" ")}`);function Pr(e){$(`Executing yt-dlp with args: ["${e.map(r=>r.replace('"','\\"')).join('", "')}"]`);let t="";return new Promise((r,i)=>{me=(0,K.spawn)("yt-dlp",e,{cwd:Fe()}),me.stdout.on("data",n=>Ue(n)),me.stderr.on("data",n=>{Ue(n),_r(`yt-dlp encountered an error: ${n}`),t+=n}),me.on("exit",n=>{me=null,n===0?r(Q):i(new Error(t||`yt-dlp exited with code ${n}`))})})}function Zn(e){$(`Executing ffmpeg with args: ["${e.map(r=>r.replace('"','\\"')).join('", "')}"]`);let t="";return new Promise((r,i)=>{de=(0,K.spawn)("ffmpeg",e,{cwd:Fe()}),de.stdout.on("data",n=>Ue(n)),de.stderr.on("data",n=>{Ue(n),_r(`ffmpeg encountered an error: ${n}`),t+=n}),de.on("exit",n=>{de=null,n===0?r(Q):i(new Error(t||`ffmpeg exited with code ${n}`))})})}async function $n(e,t){return t||=T.mkdtempSync(xt.default.join(kr.default.tmpdir(),"vencord_mediaDownloader_")),T.existsSync(t)||T.mkdirSync(t,{recursive:!0}),Z=t,$("Using workdir: ",Z),Z}async function Hn(e){Z&&($("Cleaning up workdir"),T.rmSync(Z,{recursive:!0}),Z=null)}async function Bn(e){Q="";let t=JSON.parse(await Pr(["-J",e.url,"--no-warnings"]));if(t.is_live)throw"Live streams are not supported.";return Q="",{videoTitle:`${t.title||"video"} (${t.id})`}}function qn({videoTitle:e},{maxFileSize:t,format:r}){let i=!!t,n=i?t*.8:0,a=i?t*.2:0,o={noFfmpeg:"ba[ext=mp3]{TOT_SIZE}/wa[ext=mp3]{TOT_SIZE}",ffmpeg:"ba*{TOT_SIZE}/ba{TOT_SIZE}/wa*{TOT_SIZE}/ba*"},s={noFfmpeg:"b{TOT_SIZE}{HEIGHT}[ext=webm]/b{TOT_SIZE}{HEIGHT}[ext=mp4]/w{HEIGHT}{TOT_SIZE}",ffmpeg:"b*{VID_SIZE}{HEIGHT}+ba{AUD_SIZE}/b{TOT_SIZE}{HEIGHT}/b*{HEIGHT}+ba"},l={ffmpeg:"bv{TOT_SIZE}/wv{TOT_SIZE}"},f;switch(r){case"audio":f=o;break;case"gif":f=l;break;case"video":default:f=s;break}let p=(ae?f.ffmpeg:f.noFfmpeg)?.replaceAll("{TOT_SIZE}",i?`[filesize<${t}]`:"").replaceAll("{VID_SIZE}",i?`[filesize<${n}]`:"").replaceAll("{AUD_SIZE}",i?`[filesize<${a}]`:"").replaceAll("{HEIGHT}","[height<=1080]");if(!p)throw"Gif format is only supported with ffmpeg.";return $("Video formated calculated as ",p),$(`Based on: format=${r}, maxFileSize=${t}, ffmpegAvailable=${ae}`),{format:p,videoTitle:e}}async function Jn({format:e,videoTitle:t},{ytdlpArgs:r,url:i,format:n}){Ar();let a=["-f",e,"-o","download.%(ext)s","--force-overwrites","-I","1"],o=ae?n==="video"?["--remux-video","webm>webm/mp4"]:n==="audio"?["--extract-audio","--audio-format","mp3"]:[]:[],s=r?.filter(Boolean)||[];await Pr([i,...a,...o,...s]);let l=T.readdirSync(Fe()).find(f=>f.startsWith("download."));if(!l)throw"No video file was found!";return{file:l,videoTitle:t}}async function Xn({file:e,videoTitle:t},{ffmpegArgs:r,format:i,maxFileSize:n,gifQuality:a}){let o=e.split(".").pop();if(!ae)return $("Skipping remux, ffmpeg is unavailable."),{file:e,videoTitle:t,extension:o};let s=["mp3","mp4","webm"],l=T.statSync(oe(e)).size,f=r?.filter(Boolean)||[],p=s.includes(o??""),u=!n||l<=n,g=f.length>0;if(p&&u&&!g&&!(i==="gif"))return $("Skipping remux, file type and size are good, and no ffmpeg arguments were specified."),{file:e,videoTitle:t,extension:o};let W=parseFloat((0,K.execFileSync)("ffprobe",["-v","error","-show_entries","format=duration","-of","default=noprint_wrappers=1:nokey=1",oe(e)]).toString());if(isNaN(W))throw"Failed to get video duration.";let v=~~((n?n*7/W:9999999)/1024),w,b;switch(i){case"audio":w=["-i",oe(e),"-b:a",`${v}k`,"-maxrate",`${v}k`,"-bufsize","1M","-y"],b="mp3";break;case"video":default:let S=v<=100?480:v<=500?720:1080;w=["-i",oe(e),"-b:v",`${~~(v*.8)}k`,"-b:a",`${~~(v*.2)}k`,"-maxrate",`${v}k`,"-bufsize","1M","-y","-filter:v",`scale=-1:${S}`],b="mp4";break;case"gif":let E,A,_,N;switch(a){case 1:E=5,A=360,_=24,N=5;break;case 2:E=10,A=420,_=32,N=5;break;default:case 3:E=15,A=480,_=64,N=4;break;case 4:E=20,A=540,_=64,N=3;break;case 5:E=30,A=720,_=128,N=1;break}w=["-i",oe(e),"-vf",`fps=${E},scale=w=${A}:h=-1:flags=lanczos,mpdecimate,split[s0][s1];[s0]palettegen=max_colors=${_}[p];[s1][p]paletteuse=dither=bayer:bayer_scale=${N}`,"-loop","0","-bufsize","1M","-y"],b="gif";break}return await Zn([...w,...f,`remux.${b}`]),{file:`remux.${b}`,videoTitle:t,extension:b}}function Yn({file:e,videoTitle:t,extension:r}){if(!r)throw"Invalid extension.";return{buffer:T.readFileSync(oe(e)),title:`${t}.${r}`}}async function Qn(e,t){Ge="";try{let r=await Bn(t),i=qn(r,t),n=await Jn(i,t),a=await Xn(n,t),o=Yn(a);return{logs:Ge,...o}}catch(r){return{error:r.toString(),logs:Ge}}}function Kn(e){try{return(0,K.execFileSync)("ffmpeg",["-version"]),(0,K.execFileSync)("ffprobe",["-version"]),ae=!0,!0}catch{return ae=!1,!1}}async function ei(e){try{return(0,K.execFileSync)("yt-dlp",["--version"]),St=!0,!0}catch{return St=!1,!1}}async function ti(e){$("Interrupting..."),me?.kill(),de?.kill(),Ar()}var ri=()=>Q,ni=()=>St,ii=()=>ae;var At={};k(At,{chooseDir:()=>mi,deleteFileNative:()=>ui,getDefaultNativeDataDir:()=>ee,getDefaultNativeImageDir:()=>_e,getImageNative:()=>ci,getLogsFromFs:()=>pi,getNativeSavedImages:()=>si,getSettings:()=>Ve,init:()=>zr,initDirs:()=>Lr,messageLoggerEnhancedUniqueIdThingyIdkMan:()=>ai,showItemInFolder:()=>di,writeImageNative:()=>li,writeLogs:()=>hi});c();var U=require("node:fs/promises"),se=J(require("node:path"));c();var je=class{constructor(t=1/0){this.maxSize=t}queue=[];promise;next(){let t=this.queue.shift();t?this.promise=Promise.resolve().then(t).finally(()=>this.next()):this.promise=void 0}run(){this.promise||this.next()}push(t){this.size>=this.maxSize&&this.queue.shift(),this.queue.push(t),this.run()}unshift(t){this.size>=this.maxSize&&this.queue.pop(),this.queue.unshift(t),this.run()}get size(){return this.queue.length}};var Ze=require("electron");c();var bt=J(require("fs/promises")),Or=J(require("path"));c();var We=require("fs/promises"),Rr=J(require("path"));async function oi(e){try{return await(0,We.access)(e),!0}catch{return!1}}async function ge(e){await oi(e)||await(0,We.mkdir)(e)}function Et(e){return Rr.default.parse(e).name}async function Ve(){try{let e=await bt.default.readFile(await Mr(),"utf8");return JSON.parse(e)}catch{let t={logsDir:await ee(),imageCacheDir:await _e()};try{await It(t)}catch{}return t}}async function It(e){!e||await bt.default.writeFile(await Mr(),JSON.stringify(e,null,4),"utf8")}async function Mr(){let e=await ee();return await ge(e),Or.default.join(e,"mlSettings.json")}function ai(){}var ve=new Map,si=()=>ve,Dt,kt,Cr=async()=>kt??await _e(),Nr=async()=>Dt??await ee();async function Lr(){let{logsDir:e,imageCacheDir:t}=await Ve();Dt=e||await ee(),kt=t||await _e()}Lr();async function zr(e){let t=await Cr();await ge(t);let r=await(0,U.readdir)(t);for(let i of r){let n=Et(i);ve.set(n,se.default.join(t,i))}}async function ci(e,t){let r=ve.get(t);return r?await(0,U.readFile)(r):null}async function li(e,t,r){if(!t||!r)return;let i=await Cr(),n=Et(t);if(ve.get(n))return;let o=se.default.join(i,t);await ge(i),await(0,U.writeFile)(o,r),ve.set(n,o)}async function ui(e,t){let r=ve.get(t);!r||await(0,U.unlink)(r)}var Gr="message-logger-logs.json",fi=new je;async function pi(e){let t=await Nr();await ge(t);try{return JSON.parse(await(0,U.readFile)(se.default.join(t,Gr),"utf-8"))}catch{}return null}async function hi(e,t){let r=await Nr();fi.push(()=>(0,U.writeFile)(se.default.join(r,Gr),t))}async function _e(){return se.default.join(await ee(),"savedImages")}async function ee(){return se.default.join(pe,"MessageLoggerData")}async function mi(e,t){let r=await Ve(),i=r[t]||await ee(),a=(await Ze.dialog.showOpenDialog({properties:["openDirectory"],defaultPath:i})).filePaths[0];if(!a)throw Error("Invalid Directory");switch(r[t]=a,await It(r),t){case"logsDir":Dt=a;break;case"imageCacheDir":kt=a;break}return t==="imageCacheDir"&&await zr(e),a}async function di(e,t){Ze.shell.showItemInFolder(t)}var _t={};k(_t,{fetchTopAlbum:()=>gi});c();async function gi(e,t){let{apiKey:r,user:i,period:n}=t,a=`http://ws.audioscrobbler.com/2.0/?method=user.getTopAlbums&user=${i}&api_key=${r}&period=${n}&format=json&limit=1`,s=await(await fetch(a)).json();if(s.topalbums&&s.topalbums.album.length>0){let l=s.topalbums.album[0],f=l.name,p=l.artist.name,u=l.image[l.image.length-1]["#text"];return JSON.stringify({albumName:f,artistName:p,albumCoverUrl:u})}else return null}var Pt={};k(Pt,{transferMessage:()=>vi});c();async function vi(e,t,r){return(await(await fetch("http://127.0.0.1:11434/api/chat",{method:"POST",body:JSON.stringify({model:t,messages:[{role:"system",content:`Transform any user message into a Shakespearean style, except do not change any URLs or text matching the regex <(?:@[!&]?|#)\\d+>. Only repeat the user's message in a Shakespearean voice without acknowledging or responding to anything else. for context this is your message object *START* ${JSON.stringify(e)} *END* and this is the replied message object (if avalaible): *START* ${JSON.stringify(r)} *END*, remember to use context in the response`},{role:"user",content:"hello"},{role:"assistant",content:"Hark! A gentle greeting to thee, 'tis 'hello' I say."},{role:"user",content:"How are you?"},{role:"assistant",content:"How art thou faring, noble soul?"},{role:"user",content:"What is your name?"},{role:"assistant",content:"What doth they call thee, fair entity?"},{role:"user",content:"Goodbye"},{role:"assistant",content:"Fare thee well, until we meet again."},{role:"user",content:"Check this link: https://example.com"},{role:"assistant",content:"Prithee, observe this link: https://example.com"},{content:e.content,role:"user"}],stream:!1}),headers:{"Content-Type":"application/json"}})).json()).message.content}var Rt={};k(Rt,{downloadTheme:()=>Si,getThemesDir:()=>wi,themeExists:()=>yi});c();var $e=require("fs"),He=require("path");async function yi(e,t,r){return(0,$e.existsSync)((0,He.join)(t.toString(),`${r.name}.theme.css`))}function wi(e,t,r){return(0,He.join)(t.toString(),`${r.name}.theme.css`)}async function Si(e,t,r){if(!r.content||!r.name)return;let i=(0,He.join)(t.toString(),`${r.name}.theme.css`);(0,$e.writeFileSync)(i,Buffer.from(r.content,"base64"))}var Ur={AppleMusicRichPresence:lt,ConsoleShortcuts:ut,FixSpotifyEmbeds:dr,FixYoutubeEmbeds:vr,OpenInApp:mt,Translate:dt,VoiceMessages:gt,XSOverlay:vt,YoutubeAdblock:Dr,GensokyoRadioRPC:yt,Identity:wt,MediaDownloader:Tt,MessageLoggerEnhanced:At,RPCStats:_t,Shakespearean:Pt,ThemeLibrary:Rt};var Fr={};for(let[e,t]of Object.entries(Ur)){let r=Object.entries(t);if(!r.length)continue;let i=Fr[e]={};for(let[n,a]of r){let o=`VencordPluginNative_${e}_${n}`;Ot.ipcMain.handle(o,a),i[n]=o}}Ot.ipcMain.on("VencordGetPluginIpcMethodMap",e=>{e.returnValue=Fr});c();be();var y=require("electron");c();var jr="PCFkb2N0eXBlIGh0bWw+PGh0bWwgbGFuZz0iZW4iPjxoZWFkPjxtZXRhIGNoYXJzZXQ9InV0Zi04Ij48dGl0bGU+RXF1aWNvcmQgUXVpY2tDU1MgRWRpdG9yPC90aXRsZT48bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbW9uYWNvLWVkaXRvckAwLjUwLjAvbWluL3ZzL2VkaXRvci9lZGl0b3IubWFpbi5jc3MiIGludGVncml0eT0ic2hhMjU2LXRpSlBRMk8wNHovcFovQXdkeUlnaHJPTXpld2YrUEl2RWwxWUtiUXZzWms9IiBjcm9zc29yaWdpbj0iYW5vbnltb3VzIiByZWZlcnJlcnBvbGljeT0ibm8tcmVmZXJyZXIiPjxzdHlsZT4jY29udGFpbmVyLGJvZHksaHRtbHtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7dG9wOjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTttYXJnaW46MDtwYWRkaW5nOjA7b3ZlcmZsb3c6aGlkZGVufTwvc3R5bGU+PC9oZWFkPjxib2R5PjxkaXYgaWQ9ImNvbnRhaW5lciI+PC9kaXY+PHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbW9uYWNvLWVkaXRvckAwLjUwLjAvbWluL3ZzL2xvYWRlci5qcyIgaW50ZWdyaXR5PSJzaGEyNTYtS2NVNDhUR3I4NHI3dW5GN0o1SWdCbzk1YWVWckVickdlMDRTN1RjRlVqcz0iIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiIHJlZmVycmVycG9saWN5PSJuby1yZWZlcnJlciI+PC9zY3JpcHQ+PHNjcmlwdD5yZXF1aXJlLmNvbmZpZyh7cGF0aHM6e3ZzOiJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL21vbmFjby1lZGl0b3JAMC41MC4wL21pbi92cyJ9fSkscmVxdWlyZShbInZzL2VkaXRvci9lZGl0b3IubWFpbiJdLCgoKT0+e2dldEN1cnJlbnRDc3MoKS50aGVuKChlPT57dmFyIHQ9bW9uYWNvLmVkaXRvci5jcmVhdGUoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbnRhaW5lciIpLHt2YWx1ZTplLGxhbmd1YWdlOiJjc3MiLHRoZW1lOmdldFRoZW1lKCl9KTt0Lm9uRGlkQ2hhbmdlTW9kZWxDb250ZW50KCgoKT0+c2V0Q3NzKHQuZ2V0VmFsdWUoKSkpKSx3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwoKCk9Pnt0LmxheW91dCgpfSkpfSkpfSkpPC9zY3JpcHQ+PC9ib2R5PjwvaHRtbD4=";var Pe=require("fs"),we=require("fs/promises"),ye=require("path");c();var Wr=require("electron");function Vr(e){e.webContents.setWindowOpenHandler(({url:t})=>{switch(t){case"about:blank":case"https://discord.com/popout":case"https://ptb.discord.com/popout":case"https://canary.discord.com/popout":return{action:"allow"}}try{var{protocol:r}=new URL(t)}catch{return{action:"deny"}}switch(r){case"http:":case"https:":case"mailto:":case"steam:":case"spotify:":Wr.shell.openExternal(t)}return{action:"deny"}})}(0,Pe.mkdirSync)(Y,{recursive:!0});function Be(e,t){let r=(0,ye.normalize)(e),i=(0,ye.join)(e,t),n=(0,ye.normalize)(i);return n.startsWith(r)?n:null}function xi(){return(0,we.readFile)(Le,"utf-8").catch(()=>"")}function Ti(){return(0,we.readdir)(Y).then(e=>Promise.all(e.map(async t=>({fileName:t,content:await Zr(t)})))).catch(()=>[])}function Zr(e){e=e.replace(/\?v=\d+$/,"");let t=Be(Y,e);return t?(0,we.readFile)(t,"utf-8"):Promise.reject(`Unsafe path ${e}`)}y.ipcMain.handle("VencordOpenQuickCss",()=>y.shell.openPath(Le));y.ipcMain.handle("VencordOpenExternal",(e,t)=>{try{var{protocol:r}=new URL(t)}catch{throw"Malformed URL"}if(!lr.includes(r))throw"Disallowed protocol.";y.shell.openExternal(t)});y.ipcMain.handle("VencordGetQuickCss",()=>xi());y.ipcMain.handle("VencordSetQuickCss",(e,t)=>(0,Pe.writeFileSync)(Le,t));y.ipcMain.handle("VencordGetThemesDir",()=>Y);y.ipcMain.handle("VencordGetThemesList",()=>Ti());y.ipcMain.handle("VencordGetThemeData",(e,t)=>Zr(t));y.ipcMain.handle("VencordGetThemeSystemValues",()=>({"os-accent-color":`#${y.systemPreferences.getAccentColor?.()||""}`}));y.ipcMain.handle("VencordOpenMonacoEditor",async()=>{let e="Equicord QuickCSS Editor",t=y.BrowserWindow.getAllWindows().find(i=>i.title===e);if(t&&!t.isDestroyed()){t.focus();return}let r=new y.BrowserWindow({title:e,autoHideMenuBar:!0,darkTheme:!0,webPreferences:{preload:(0,ye.join)(__dirname,"preload.js"),contextIsolation:!0,nodeIntegration:!1,sandbox:!1}});Vr(r),await r.loadURL(`data:text/html;base64,${jr}`)});c();var fn=require("electron");c();var Br=require("module"),Ei=(0,Br.createRequire)("/"),Je,bi=";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global";try{Je=Ei("worker_threads").Worker}catch{}var Ii=Je?function(e,t,r,i,n){var a=!1,o=new Je(e+bi,{eval:!0}).on("error",function(s){return n(s,null)}).on("message",function(s){return n(null,s)}).on("exit",function(s){s&&!a&&n(new Error("exited with code "+s),null)});return o.postMessage(r,i),o.terminate=function(){return a=!0,Je.prototype.terminate.call(o)},o}:function(e,t,r,i,n){setImmediate(function(){return n(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var a=function(){};return{terminate:a,postMessage:a}},D=Uint8Array,ce=Uint16Array,qr=Int32Array,Nt=new D([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Lt=new D([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Jr=new D([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xr=function(e,t){for(var r=new ce(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];for(var n=new qr(r[30]),i=1;i<30;++i)for(var a=r[i];a<r[i+1];++a)n[a]=a-r[i]<<5|i;return{b:r,r:n}},Yr=Xr(Nt,2),zt=Yr.b,Di=Yr.r;zt[28]=258,Di[258]=28;var Qr=Xr(Lt,0),Kr=Qr.b,Oa=Qr.r,Qe=new ce(32768);for(d=0;d<32768;++d)H=(d&43690)>>1|(d&21845)<<1,H=(H&52428)>>2|(H&13107)<<2,H=(H&61680)>>4|(H&3855)<<4,Qe[d]=((H&65280)>>8|(H&255)<<8)>>1;var H,d,Se=function(e,t,r){for(var i=e.length,n=0,a=new ce(t);n<i;++n)e[n]&&++a[e[n]-1];var o=new ce(t);for(n=1;n<t;++n)o[n]=o[n-1]+a[n-1]<<1;var s;if(r){s=new ce(1<<t);var l=15-t;for(n=0;n<i;++n)if(e[n])for(var f=n<<4|e[n],p=t-e[n],u=o[e[n]-1]++<<p,g=u|(1<<p)-1;u<=g;++u)s[Qe[u]>>l]=f}else for(s=new ce(i),n=0;n<i;++n)e[n]&&(s[n]=Qe[o[e[n]-1]++]>>15-e[n]);return s},Re=new D(288);for(d=0;d<144;++d)Re[d]=8;var d;for(d=144;d<256;++d)Re[d]=9;var d;for(d=256;d<280;++d)Re[d]=7;var d;for(d=280;d<288;++d)Re[d]=8;var d,en=new D(32);for(d=0;d<32;++d)en[d]=5;var d;var tn=Se(Re,9,1);var rn=Se(en,5,1),Xe=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},M=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(t&7)&r},Ye=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},nn=function(e){return(e+7)/8|0},Ke=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new D(e.subarray(t,r))};var on=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],I=function(e,t,r){var i=new Error(t||on[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,I),!r)throw i;return i},an=function(e,t,r,i){var n=e.length,a=i?i.length:0;if(!n||t.f&&!t.l)return r||new D(0);var o=!r,s=o||t.i!=2,l=t.i;o&&(r=new D(n*3));var f=function($t){var Ht=r.length;if($t>Ht){var Bt=new D(Math.max(Ht*2,$t));Bt.set(r),r=Bt}},p=t.f||0,u=t.p||0,g=t.b||0,C=t.l,W=t.d,G=t.m,v=t.n,w=n*8;do{if(!C){p=M(e,u,1);var b=M(e,u+1,3);if(u+=3,b)if(b==1)C=tn,W=rn,G=9,v=5;else if(b==2){var _=M(e,u,31)+257,N=M(e,u+10,15)+4,re=_+M(e,u+5,31)+1;u+=14;for(var P=new D(re),le=new D(19),x=0;x<N;++x)le[Jr[x]]=M(e,u+x*3,7);u+=N*3;for(var Te=Xe(le),mn=(1<<Te)-1,dn=Se(le,Te,1),x=0;x<re;){var Ft=dn[M(e,u,mn)];u+=Ft&15;var S=Ft>>4;if(S<16)P[x++]=S;else{var ue=0,Oe=0;for(S==16?(Oe=3+M(e,u,3),u+=2,ue=P[x-1]):S==17?(Oe=3+M(e,u,7),u+=3):S==18&&(Oe=11+M(e,u,127),u+=7);Oe--;)P[x++]=ue}}var jt=P.subarray(0,_),B=P.subarray(_);G=Xe(jt),v=Xe(B),C=Se(jt,G,1),W=Se(B,v,1)}else I(1);else{var S=nn(u)+4,E=e[S-4]|e[S-3]<<8,A=S+E;if(A>n){l&&I(0);break}s&&f(g+E),r.set(e.subarray(S,A),g),t.b=g+=E,t.p=u=A*8,t.f=p;continue}if(u>w){l&&I(0);break}}s&&f(g+131072);for(var gn=(1<<G)-1,vn=(1<<v)-1,et=u;;et=u){var ue=C[Ye(e,u)&gn],fe=ue>>4;if(u+=ue&15,u>w){l&&I(0);break}if(ue||I(2),fe<256)r[g++]=fe;else if(fe==256){et=u,C=null;break}else{var Wt=fe-254;if(fe>264){var x=fe-257,Ee=Nt[x];Wt=M(e,u,(1<<Ee)-1)+zt[x],u+=Ee}var tt=W[Ye(e,u)&vn],rt=tt>>4;tt||I(3),u+=tt&15;var B=Kr[rt];if(rt>3){var Ee=Lt[rt];B+=Ye(e,u)&(1<<Ee)-1,u+=Ee}if(u>w){l&&I(0);break}s&&f(g+131072);var Vt=g+Wt;if(g<B){var Zt=a-B,yn=Math.min(B,Vt);for(Zt+g<0&&I(3);g<yn;++g)r[g]=i[Zt+g]}for(;g<Vt;++g)r[g]=r[g-B]}}t.l=C,t.p=et,t.b=g,t.f=p,C&&(p=1,t.m=G,t.d=W,t.n=v)}while(!p);return g!=r.length&&o?Ke(r,0,g):r.subarray(0,g)};var ki=new D(0);var Ai=function(e,t){var r={};for(var i in e)r[i]=e[i];for(var i in t)r[i]=t[i];return r},$r=function(e,t,r){for(var i=e(),n=e.toString(),a=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<i.length;++o){var s=i[o],l=a[o];if(typeof s=="function"){t+=";"+l+"=";var f=s.toString();if(s.prototype)if(f.indexOf("[native code]")!=-1){var p=f.indexOf(" ",8)+1;t+=f.slice(p,f.indexOf("(",p))}else{t+=f;for(var u in s.prototype)t+=";"+l+".prototype."+u+"="+s.prototype[u].toString()}else t+=f}else r[l]=s}return t},qe=[],_i=function(e){var t=[];for(var r in e)e[r].buffer&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t},Pi=function(e,t,r,i){if(!qe[r]){for(var n="",a={},o=e.length-1,s=0;s<o;++s)n=$r(e[s],n,a);qe[r]={c:$r(e[o],n,a),e:a}}var l=Ai({},qe[r].e);return Ii(qe[r].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,l,_i(l),i)},Ri=function(){return[D,ce,qr,Nt,Lt,Jr,zt,Kr,tn,rn,Qe,on,Se,Xe,M,Ye,nn,Ke,I,an,Gt,sn,cn]};var sn=function(e){return postMessage(e,[e.buffer])},cn=function(e){return e&&{out:e.size&&new D(e.size),dictionary:e.dictionary}},Oi=function(e,t,r,i,n,a){var o=Pi(r,i,n,function(s,l){o.terminate(),a(s,l)});return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}};var F=function(e,t){return e[t]|e[t+1]<<8},z=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Mt=function(e,t){return z(e,t)+z(e,t+4)*4294967296};function Mi(e,t,r){return r||(r=t,t={}),typeof r!="function"&&I(7),Oi(e,t,[Ri],function(i){return sn(Gt(i.data[0],cn(i.data[1])))},1,r)}function Gt(e,t){return an(e,{i:2},t&&t.out,t&&t.dictionary)}var Ct=typeof TextDecoder<"u"&&new TextDecoder,Ci=0;try{Ct.decode(ki,{stream:!0}),Ci=1}catch{}var Ni=function(e){for(var t="",r=0;;){var i=e[r++],n=(i>127)+(i>223)+(i>239);if(r+n>e.length)return{s:t,r:Ke(e,r-1)};n?n==3?(i=((i&15)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,t+=String.fromCharCode(55296|i>>10,56320|i&1023)):n&1?t+=String.fromCharCode((i&31)<<6|e[r++]&63):t+=String.fromCharCode((i&15)<<12|(e[r++]&63)<<6|e[r++]&63):t+=String.fromCharCode(i)}};function Li(e,t){if(t){for(var r="",i=0;i<e.length;i+=16384)r+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return r}else{if(Ct)return Ct.decode(e);var n=Ni(e),a=n.s,r=n.r;return r.length&&I(8),a}}var zi=function(e,t){return t+30+F(e,t+26)+F(e,t+28)},Gi=function(e,t,r){var i=F(e,t+28),n=Li(e.subarray(t+46,t+46+i),!(F(e,t+8)&2048)),a=t+46+i,o=z(e,t+20),s=r&&o==4294967295?Ui(e,a):[o,z(e,t+24),z(e,t+42)],l=s[0],f=s[1],p=s[2];return[F(e,t+10),l,f,n,a+F(e,t+30)+F(e,t+32),p]},Ui=function(e,t){for(;F(e,t)!=1;t+=4+F(e,t+2));return[Mt(e,t+12),Mt(e,t+4),Mt(e,t+20)]};var Hr=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(e){e()};function ln(e,t,r){r||(r=t,t={}),typeof r!="function"&&I(7);var i=[],n=function(){for(var v=0;v<i.length;++v)i[v]()},a={},o=function(v,w){Hr(function(){r(v,w)})};Hr(function(){o=r});for(var s=e.length-22;z(e,s)!=101010256;--s)if(!s||e.length-s>65558)return o(I(13,0,1),null),n;var l=F(e,s+8);if(l){var f=l,p=z(e,s+16),u=p==4294967295||f==65535;if(u){var g=z(e,s-12);u=z(e,g)==101075792,u&&(f=l=z(e,g+32),p=z(e,g+48))}for(var C=t&&t.filter,W=function(v){var w=Gi(e,p,u),b=w[0],S=w[1],E=w[2],A=w[3],_=w[4],N=w[5],re=zi(e,N);p=_;var P=function(x,Te){x?(n(),o(x,null)):(Te&&(a[A]=Te),--l||o(null,a))};if(!C||C({name:A,size:S,originalSize:E,compression:b}))if(!b)P(null,Ke(e,re,re+S));else if(b==8){var le=e.subarray(re,re+S);if(E<524288||S>.8*E)try{P(null,Gt(le,{out:new D(E)}))}catch(x){P(x,null)}else i.push(Mi(le,{size:E},P))}else P(I(14,"unknown compression type "+b,1),null);else P(null,null)},G=0;G<f;++G)W(G)}else o(null,{});return n}var pn=require("fs"),j=require("fs/promises"),xe=require("path");c();function un(e){function t(o,s,l,f){let p=0;return p+=o<<0,p+=s<<8,p+=l<<16,p+=f<<24>>>0,p}if(e[0]===80&&e[1]===75&&e[2]===3&&e[3]===4)return e;if(e[0]!==67||e[1]!==114||e[2]!==50||e[3]!==52)throw new Error("Invalid header: Does not start with Cr24");let r=e[4]===3,i=e[4]===2;if(!i&&!r||e[5]||e[6]||e[7])throw new Error("Unexpected crx format version number.");if(i){let o=t(e[8],e[9],e[10],e[11]),s=t(e[12],e[13],e[14],e[15]),l=16+o+s;return e.subarray(l,e.length)}let a=12+t(e[8],e[9],e[10],e[11]);return e.subarray(a,e.length)}nt();var Fi=(0,xe.join)(pe,"ExtensionCache");async function ji(e,t){return await(0,j.mkdir)(t,{recursive:!0}),new Promise((r,i)=>{ln(e,(n,a)=>{if(n)return void i(n);Promise.all(Object.keys(a).map(async o=>{if(o.startsWith("_metadata/"))return;if(o.endsWith("/"))return void(0,j.mkdir)((0,xe.join)(t,o),{recursive:!0});let s=o.split("/"),l=s.pop(),f=s.join("/"),p=(0,xe.join)(t,f);f&&await(0,j.mkdir)(p,{recursive:!0}),await(0,j.writeFile)((0,xe.join)(p,l),a[o])})).then(()=>r()).catch(o=>{(0,j.rm)(t,{recursive:!0,force:!0}),i(o)})})})}async function hn(e){let t=(0,xe.join)(Fi,`${e}`);try{await(0,j.access)(t,pn.constants.F_OK)}catch{let i=e==="fmkadmapgofadopljbjfkapdkoienihi"?"https://raw.githubusercontent.com/Vendicated/random-files/f6f550e4c58ac5f2012095a130406c2ab25b984d/fmkadmapgofadopljbjfkapdkoienihi.zip":`https://clients2.google.com/service/update2/crx?response=redirect&acceptformat=crx2,crx3&x=id%3D${e}%26uc&prodversion=32`,n=await ne(i,{headers:{"User-Agent":"Equicord (https://github.com/Equicord/Equicord)"}});await ji(un(n),t).catch(console.error)}fn.session.defaultSession.loadExtension(t)}ur||te.app.whenReady().then(()=>{te.protocol.registerFileProtocol("vencord",({url:n},a)=>{let o=n.slice(10);if(o.endsWith("/")&&(o=o.slice(0,-1)),o.startsWith("/themes/")){let s=o.slice(8),l=Be(Y,s);if(!l){a({statusCode:403});return}a(l.replace(/\?v=\d+$/,""));return}switch(o){case"renderer.js.map":case"preload.js.map":case"patcher.js.map":case"main.js.map":a((0,Ut.join)(__dirname,o));break;default:a({statusCode:403})}}),te.protocol.registerFileProtocol("equicord",({url:n},a)=>{let o=n.slice(11);if(o.endsWith("/")&&(o=o.slice(0,-1)),o.startsWith("/themes/")){let s=o.slice(8),l=Be(Y,s);if(!l){a({statusCode:403});return}a(l.replace(/\?v=\d+$/,""));return}switch(o){case"renderer.js.map":case"preload.js.map":case"patcher.js.map":case"main.js.map":a((0,Ut.join)(__dirname,o));break;default:a({statusCode:403})}});try{O.store.enableReactDevtools&&hn("fmkadmapgofadopljbjfkapdkoienihi").then(()=>console.info("[Equicord] Installed React Developer Tools")).catch(n=>console.error("[Equicord] Failed to install React Developer Tools",n))}catch{}let e=(n,a)=>Object.keys(n).find(o=>o.toLowerCase()===a),t=n=>{let a={};return n.split(";").forEach(o=>{let[s,...l]=o.trim().split(/\s+/g);s&&!Object.prototype.hasOwnProperty.call(a,s)&&(a[s]=l)}),a},r=n=>Object.entries(n).filter(([,a])=>a?.length).map(a=>a.flat().join(" ")).join("; "),i=n=>{let a=e(n,"content-security-policy");if(a){let o=t(n[a][0]);for(let s of["style-src","connect-src","img-src","font-src","media-src","worker-src"])o[s]??=[],o[s].push("*","blob:","data:","vencord:","'unsafe-inline'");o["script-src"]??=[],o["script-src"].push("'unsafe-eval'","https://unpkg.com","https://cdnjs.cloudflare.com"),n[a]=[r(o)]}};te.session.defaultSession.webRequest.onHeadersReceived(({responseHeaders:n,resourceType:a},o)=>{if(n&&(a==="mainFrame"&&i(n),a==="stylesheet")){let s=e(n,"content-type");s&&(n[s]=["text/css"])}o({cancel:!1,responseHeaders:n})}),te.session.defaultSession.webRequest.onHeadersReceived=()=>{}});
//# sourceURL=VencordMain
//# sourceMappingURL=vencord://main.js.map
/*! For license information please see main.js.LEGAL.txt */
